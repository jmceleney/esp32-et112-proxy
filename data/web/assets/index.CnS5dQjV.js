import{l as V,_ as B,H as ie,d as m,E as D,k,y as L,A as j,D as le,L as R,G as ne}from"./vendor.C5hRi-Ny.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))c(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&c(d)}).observe(document,{childList:!0,subtree:!0});function i(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function c(s){if(s.ep)return;s.ep=!0;const a=i(s);fetch(s.href,a)}})();var ae=0;function e(r,l,i,c,s,a){l||(l={});var d,u,p=l;if("ref"in p)for(u in p={},l)u=="ref"?d=l[u]:p[u]=l[u];var g={type:r,props:p,key:i,ref:d,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--ae,__i:-1,__u:0,__source:s,__self:a};if(typeof r=="function"&&(d=r.defaultProps))for(u in d)p[u]===void 0&&(p[u]=d[u]);return V.vnode&&V.vnode(g),g}const J="";async function Y(r,l={}){try{const i=await fetch(J+r,{headers:{"Content-Type":"application/json",...l.headers},...l});if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);const c=i.headers.get("content-type");return c&&c.includes("application/json")?await i.json():await i.text()}catch(i){throw console.error(`API Error for ${r}:`,i),i}}async function $(r){return Y(r)}async function T(r,l=null){const i={method:"POST"};return l&&(l instanceof FormData?(delete i.headers,i.body=l):i.body=JSON.stringify(l)),Y(r,i)}const P={getStatus:()=>$("/status.json"),getLogs:(r=0,l=8192)=>$(`/logdata?position=${r}&chunk_size=${l}`),clearLogs:()=>T("/logclear"),getConfig:()=>$("/config"),updateConfig:r=>{const l=new FormData;return Object.entries(r).forEach(([i,c])=>{typeof c=="boolean"?c&&l.append(i,"on"):l.append(i,c)}),T("/config",l)},sendDebugCommand:(r,l,i,c)=>{const s=new FormData;return s.append("slave",r),s.append("reg",l),s.append("func",i),s.append("count",c),T("/debug",s)},reboot:()=>T("/reboot"),resetWifi:()=>T("/wifi"),uploadFirmware:(r,l)=>new Promise((i,c)=>{const s=new FormData;s.append("file",r);const a=new XMLHttpRequest;a.upload.addEventListener("progress",d=>{d.lengthComputable&&l&&l(Math.round(d.loaded/d.total*100))}),a.addEventListener("load",()=>{a.status>=200&&a.status<300?i(a.responseText):c(new Error(`Upload failed: ${a.status} ${a.statusText}`))}),a.addEventListener("error",()=>{c(new Error("Upload failed"))}),a.open("POST",J+"/update"),a.send(s)}),getMetrics:()=>$("/metrics")};/**
 * @license lucide-preact v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),se=r=>r.replace(/^([A-Z])|[\s-_]+(\w)/g,(l,i,c)=>c?c.toUpperCase():i.toLowerCase()),Z=r=>{const l=se(r);return l.charAt(0).toUpperCase()+l.slice(1)},oe=(...r)=>r.filter((l,i,c)=>!!l&&l.trim()!==""&&c.indexOf(l)===i).join(" ").trim();/**
 * @license lucide-preact v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var ce={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"};/**
 * @license lucide-preact v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=({color:r="currentColor",size:l=24,strokeWidth:i=2,absoluteStrokeWidth:c,children:s,iconNode:a,class:d="",...u})=>B("svg",{...ce,width:String(l),height:l,stroke:r,"stroke-width":c?Number(i)*24/Number(l):i,class:["lucide",d].join(" "),...u},[...a.map(([p,g])=>B(p,g)),...ie(s)]);/**
 * @license lucide-preact v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y=(r,l)=>{const i=({class:c="",children:s,...a})=>B(de,{...a,iconNode:l,class:oe(`lucide-${G(Z(r))}`,`lucide-${G(r)}`,c)},s);return i.displayName=Z(r),i};/**
 * @license lucide-preact v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=y("chart-column",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-preact v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=y("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-preact v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=y("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-preact v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=y("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-preact v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=y("cpu",[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]]);/**
 * @license lucide-preact v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=y("file-check",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);/**
 * @license lucide-preact v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=y("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-preact v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=y("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-preact v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=y("lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-preact v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=y("link-2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-preact v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=y("pause",[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]]);/**
 * @license lucide-preact v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=y("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]);/**
 * @license lucide-preact v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=y("radio",[["path",{d:"M16.247 7.761a6 6 0 0 1 0 8.478",key:"1fwjs5"}],["path",{d:"M19.075 4.933a10 10 0 0 1 0 14.134",key:"ehdyv1"}],["path",{d:"M4.925 19.067a10 10 0 0 1 0-14.134",key:"1q22gi"}],["path",{d:"M7.753 16.239a6 6 0 0 1 0-8.478",key:"r2q7qm"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-preact v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=y("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-preact v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=y("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-preact v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=y("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-preact v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=y("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-preact v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=y("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);/**
 * @license lucide-preact v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=y("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]);/**
 * @license lucide-preact v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=y("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-preact v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=y("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);/**
 * @license lucide-preact v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=y("wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-preact v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=y("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-preact v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=y("wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]]);/**
 * @license lucide-preact v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=y("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);function xe({currentRoute:r}){const[l,i]=m(!1),[c,s]=m(!1),[a,d]=m(!1),[u,p]=m(null),g=async()=>{d(!0),p(null);try{await P.resetWifi(),i(!1),alert("WiFi settings reset! Device will restart and enter configuration mode.")}catch(n){p(n.message||"Failed to reset WiFi settings")}finally{d(!1)}},h=async()=>{d(!0),p(null);try{await P.reboot(),s(!1),alert("Device rebooting... Please wait 30 seconds before reconnecting.")}catch(n){p(n.message||"Failed to reboot device")}finally{d(!1)}},b=n=>r===n;return e(k,{children:[e("nav",{class:"navigation",children:e("div",{class:"nav-container",children:[e(D,{href:"/",class:"nav-brand",children:[e("div",{class:"nav-brand-icon",children:"E"}),e("span",{children:"ET112 Proxy"})]}),e("div",{class:"nav-menu",children:[e(D,{class:`nav-link ${b("/")?"active":""}`,href:"/",children:[e(me,{size:18})," Home"]}),e(D,{class:`nav-link ${b("/status")?"active":""}`,href:"/status",children:[e(ee,{size:18})," Status"]}),e(D,{class:`nav-link ${b("/config")?"active":""}`,href:"/config",children:[e(re,{size:18})," Config"]}),e(D,{class:`nav-link ${b("/debug")?"active":""}`,href:"/debug",children:[e(U,{size:18})," Debug"]}),e(D,{class:`nav-link ${b("/log")?"active":""}`,href:"/log",children:[e(E,{size:18})," Logs"]}),e(D,{class:`nav-link ${b("/update")?"active":""}`,href:"/update",children:[e(W,{size:18})," Update"]})]}),e("div",{class:"nav-actions",children:[e("button",{class:"nav-link danger btn-link",onClick:()=>i(!0),disabled:a,title:"Reset WiFi Settings",children:e(ke,{size:18})}),e("button",{class:"nav-link danger btn-link",onClick:()=>s(!0),disabled:a,title:"Reboot Device",children:e(F,{size:18})})]})]})}),l&&e("div",{class:"modal-overlay",children:e("div",{class:"modal",children:[e("h3",{children:[e(q,{size:20,style:"display: inline; margin-right: 0.5rem;"}),"WiFi Reset Confirmation"]}),e("p",{children:"This will reset all WiFi settings and restart the device in configuration mode."}),e("ul",{style:"margin: 1rem 0; padding-left: 1.5rem; line-height: 1.6;",children:[e("li",{children:"Current WiFi credentials will be erased"}),e("li",{children:"Device will restart and create an access point"}),e("li",{children:"You'll need to reconnect and reconfigure WiFi"}),e("li",{children:"This action cannot be undone"})]}),u&&e("div",{class:"error-message",style:"margin-bottom: 1rem; color: var(--danger-color);",children:[e(S,{size:16,style:"display: inline; margin-right: 0.25rem;"}),u]}),e("div",{class:"modal-actions",children:[e("button",{class:"btn btn-danger",onClick:g,disabled:a,children:a?e(k,{children:"⏳ Resetting..."}):e(k,{children:[e(F,{size:16,style:"margin-right: 0.25rem;"}),"Reset WiFi"]})}),e("button",{class:"btn btn-secondary",onClick:()=>i(!1),disabled:a,children:"Cancel"})]})]})}),c&&e("div",{class:"modal-overlay",children:e("div",{class:"modal",children:[e("h3",{children:[e(F,{size:20,style:"display: inline; margin-right: 0.5rem;"}),"Reboot Confirmation"]}),e("p",{children:"This will restart the ESP32 device immediately."}),e("ul",{style:"margin: 1rem 0; padding-left: 1.5rem; line-height: 1.6;",children:[e("li",{children:"Device will restart and take ~30 seconds to boot"}),e("li",{children:"All current connections will be lost"}),e("li",{children:"Configuration and data will be preserved"}),e("li",{children:"You'll need to refresh this page after restart"})]}),u&&e("div",{class:"error-message",style:"margin-bottom: 1rem; color: var(--danger-color);",children:[e(S,{size:16,style:"display: inline; margin-right: 0.25rem;"}),u]}),e("div",{class:"modal-actions",children:[e("button",{class:"btn btn-danger",onClick:h,disabled:a,children:a?e(k,{children:"⏳ Rebooting..."}):e(k,{children:[e(F,{size:16,style:"margin-right: 0.25rem;"}),"Reboot Device"]})}),e("button",{class:"btn btn-secondary",onClick:()=>s(!1),disabled:a,children:"Cancel"})]})]})})]})}function ze(){const[r,l]=m({voltage:null,current:null,power:null,frequency:null,uptime:null}),[i,c]=m(!0),[s,a]=m(null),[d,u]=m(null),p=async()=>{var n,o,t,f,x,I;try{const C=(await P.getStatus()).data||[],v={};C.forEach(z=>{z.name&&z.value&&(v[z.name]=z.value)}),l({voltage:parseFloat((n=v.Volts)==null?void 0:n.replace(" V",""))||null,current:parseFloat((o=v.Amps)==null?void 0:o.replace(" A",""))||null,power:parseFloat((t=v.Watts)==null?void 0:t.replace(" W",""))||null,frequency:parseFloat((f=v.Frequency)==null?void 0:f.replace(" Hz",""))||null,uptime:v["ESP Uptime"]||null,cpuCore0:parseFloat((x=v["ESP CPU Core 0 Load"])==null?void 0:x.replace("%",""))||null,cpuCore1:parseFloat((I=v["ESP CPU Core 1 Load"])==null?void 0:I.replace("%",""))||null}),a(null),u(new Date)}catch(w){console.error("Failed to fetch metrics:",w),a(w.message||"Failed to fetch metrics")}finally{c(!1)}};L(()=>{p();const n=setInterval(p,2e3);return()=>clearInterval(n)},[]);const g=(n,o,t=1)=>n==null?"---":`${n.toFixed(t)}${o}`,h=()=>i?"var(--warning-color)":s?"var(--danger-color)":r.power!==null?"var(--success-color)":"var(--text-muted)",b=()=>i?"Loading...":s?"Connection Error":r.power!==null?"Online":"No Data";return e("div",{children:[e("div",{class:"page-header",children:[e("h1",{class:"page-title",children:"ESP32 ET112 Energy Monitor"}),e("p",{class:"page-subtitle",children:"Real-time power monitoring from Carlo Gavazzi ET112 energy meter"})]}),e("div",{class:"card",children:e("div",{style:"display: flex; align-items: center; justify-content: space-between;",children:[e("div",{style:"display: flex; align-items: center; gap: 0.75rem;",children:[e("div",{style:`width: 12px; height: 12px; border-radius: 50%; background: ${h()};`}),e("span",{class:"font-semibold",children:b()})]}),d&&e("span",{class:"text-muted text-sm",children:["Last updated: ",d.toLocaleTimeString()]})]})}),s&&e("div",{class:"card",style:"background-color: var(--danger-color); color: white; margin-bottom: 1.5rem;",children:e("p",{style:"margin: 0;",children:[e(S,{size:16,style:"display: inline; margin-right: 0.25rem;"}),s]})}),e("div",{class:"grid-3",children:[e("div",{class:"card metric-card",style:"background: linear-gradient(135deg, #10b981 0%, #059669 100%);",children:[e("div",{class:"card-title",children:"Voltage"}),e("div",{class:"metric-value",children:i?"---":g(r.voltage,"",1)}),e("div",{class:"metric-unit",children:"Volts"})]}),e("div",{class:"card metric-card",style:"background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);",children:[e("div",{class:"card-title",children:"Current"}),e("div",{class:"metric-value",children:i?"---":g(r.current,"",2)}),e("div",{class:"metric-unit",children:"Amperes"})]}),e("div",{class:"card metric-card",style:"background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);",children:[e("div",{class:"card-title",children:"Active Power"}),e("div",{class:"metric-value",children:i?"---":g(r.power,"",0)}),e("div",{class:"metric-unit",children:"Watts"})]})]}),e("div",{class:"grid-4",children:[e("div",{class:"card",children:[e("div",{class:"card-title",children:[e(Q,{size:18,style:"display: inline; margin-right: 0.25rem;"}),"Frequency"]}),e("div",{style:"font-size: 1.5rem; font-weight: 600; color: var(--primary-color);",children:i?"---":g(r.frequency," Hz",2)})]}),e("div",{class:"card",children:[e("div",{class:"card-title",children:[e(X,{size:18,style:"display: inline; margin-right: 0.25rem;"}),"CPU Core 0"]}),e("div",{style:"font-size: 1.5rem; font-weight: 600; color: var(--secondary-color);",children:i?"---":g(r.cpuCore0,"%",1)})]}),e("div",{class:"card",children:[e("div",{class:"card-title",children:[e(X,{size:18,style:"display: inline; margin-right: 0.25rem;"}),"CPU Core 1"]}),e("div",{style:"font-size: 1.5rem; font-weight: 600; color: var(--secondary-color);",children:i?"---":g(r.cpuCore1,"%",1)})]}),e("div",{class:"card",children:[e("div",{class:"card-title",children:[e(he,{size:18,style:"display: inline; margin-right: 0.25rem;"}),"System Uptime"]}),e("div",{style:"font-size: 1.5rem; font-weight: 600; color: var(--primary-color);",children:i?"---":r.uptime||"Unknown"})]})]}),e("div",{class:"card",children:[e("div",{class:"card-title",children:[e(Q,{size:18,style:"display: inline; margin-right: 0.25rem;"}),"Quick Actions"]}),e("div",{style:"display: flex; gap: 1rem; flex-wrap: wrap;",children:[e("a",{href:"/status",class:"btn btn-primary",children:[e(ee,{size:16,style:"margin-right: 0.25rem;"}),"View Detailed Status"]}),e("a",{href:"/config",class:"btn btn-secondary",children:[e(re,{size:16,style:"margin-right: 0.25rem;"}),"Configuration"]}),e("a",{href:"/debug",class:"btn btn-secondary",children:[e(U,{size:16,style:"margin-right: 0.25rem;"}),"Debug Tools"]})]})]}),e("div",{class:"grid-2",children:[e("div",{class:"card",children:[e("div",{class:"card-title",children:[e(ve,{size:18,style:"display: inline; margin-right: 0.25rem;"}),"About This Device"]}),e("div",{class:"text-sm",style:"line-height: 1.6;",children:[e("p",{children:"This ESP32 device acts as a Modbus RTU/TCP gateway for the Carlo Gavazzi ET112 energy meter, providing real-time power monitoring data."}),e("ul",{style:"margin: 0.5rem 0; padding-left: 1.5rem;",children:[e("li",{children:"Real-time energy monitoring"}),e("li",{children:"Modbus RTU client → TCP server"}),e("li",{children:"Compatible with Victron GX devices"}),e("li",{children:"Web-based configuration"})]})]})]}),e("div",{class:"card",children:[e("div",{class:"card-title",children:[e(ge,{size:18,style:"display: inline; margin-right: 0.25rem;"}),"Quick Links"]}),e("div",{class:"text-sm",children:e("div",{style:"display: flex; flex-direction: column; gap: 0.5rem;",children:[e("a",{href:"/log",style:"color: var(--primary-color); text-decoration: none;",children:[e(E,{size:16,style:"display: inline; margin-right: 0.25rem;"}),"View System Logs"]}),e("a",{href:"/update",style:"color: var(--primary-color); text-decoration: none;",children:[e(W,{size:16,style:"display: inline; margin-right: 0.25rem;"}),"Update Firmware"]}),e("a",{href:"/debug",style:"color: var(--primary-color); text-decoration: none;",children:[e(U,{size:16,style:"display: inline; margin-right: 0.25rem;"}),"Test Modbus Communication"]}),e("a",{href:"/metrics",style:"color: var(--primary-color); text-decoration: none;",children:[e(we,{size:16,style:"display: inline; margin-right: 0.25rem;"}),"Prometheus Metrics"]})]})})]})]})]})}function Se(){const[r,l]=m(null),[i,c]=m(!0),[s,a]=m(null),d=async()=>{try{const h=await fetch("/status.json");if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);const b=await h.json();l(b),a(null)}catch(h){console.error("Failed to fetch status data:",h),a(h.message)}finally{c(!1)}};L(()=>{d();const h=setInterval(d,5e3);return()=>clearInterval(h)},[]);const u=h=>{if(typeof h=="string"){if(h.toLowerCase().includes("yes")||h.toLowerCase().includes("connected"))return"status-ok";if(h.toLowerCase().includes("no")||h.toLowerCase().includes("not connected"))return"status-error"}return""},p=(h,b)=>{const n=h.filter(o=>o.low!==void 0&&o.high!==void 0&&o.low!==""&&o.high!=="");return n.length===0?null:e("div",{class:"card",children:[e("h3",{class:"card-title",children:b}),e("div",{class:"table-responsive",children:e("table",{class:"table",children:[e("thead",{children:e("tr",{children:[e("th",{children:"Name"}),e("th",{children:"Current"}),e("th",{children:"Low"}),e("th",{children:"High"})]})}),e("tbody",{children:n.map((o,t)=>e("tr",{children:[e("td",{children:o.name}),e("td",{children:o.value}),e("td",{children:o.low}),e("td",{children:o.high})]},t))})]})})]})},g=(h,b)=>{const n=h.filter(o=>o.low===void 0||o.high===void 0||o.low===""||o.high==="");return n.length===0?null:e("div",{class:"card",children:[e("h3",{class:"card-title",children:b}),e("div",{class:"table-responsive",children:e("table",{class:"table",children:e("tbody",{children:n.map((o,t)=>e("tr",{children:[e("td",{style:"font-weight: 500;",children:o.name}),e("td",{class:u(o.value),children:o.value})]},t))})})})]})};return i?e("div",{class:"loading",children:"Loading status data..."}):s?e("div",{class:"card",children:[e("h2",{class:"card-title",children:"Error Loading Status"}),e("p",{class:"status-error",children:["Failed to load status data: ",s]}),e("button",{class:"btn btn-primary",onClick:d,children:"Retry"})]}):!r||!r.data?e("div",{class:"card",children:[e("h2",{class:"card-title",children:"No Status Data"}),e("p",{children:"No status data available."})]}):e("div",{children:[e("h1",{style:"margin-bottom: 2rem;",children:"System Status"}),e("div",{style:"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem;",children:[g(r.data,"System Information"),p(r.data,"Energy Metrics")]}),e("div",{class:"card",children:[e("div",{style:"display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;",children:[e("h3",{class:"card-title",style:"margin: 0;",children:"Raw Status Data"}),e("button",{class:"btn btn-primary",onClick:d,children:"🔄 Refresh"})]}),e("pre",{style:"background: #f8f9fa; padding: 1rem; border-radius: 4px; overflow-x: auto; font-size: 0.875rem;",children:JSON.stringify(r,null,2)})]})]})}function Ie(){const[r,l]=m({hostname:"",pi:1e3,clientIsRTU:!0,mb:9600,md:8,mp:0,ms:1,mr:-1,sip:"",tp2:502,mb2:9600,md2:8,mp2:0,ms2:1,mr2:-1,tp3:502,sb:115200,sd:8,sp:0,ss:1,useStaticIP:!1,staticIP:"",staticGateway:"",staticSubnet:""}),[i,c]=m(!1),[s,a]=m(null),[d,u]=m(!1),[p,g]=m({});L(()=>{},[]);const h=()=>{const t={};if(r.hostname.trim()||(t.hostname="Hostname is required"),r.pi<100&&(t.pi="Polling interval must be at least 100ms"),r.useStaticIP){const f=/^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/;(!r.staticIP||!f.test(r.staticIP))&&(t.staticIP="Invalid IP address"),(!r.staticGateway||!f.test(r.staticGateway))&&(t.staticGateway="Invalid gateway IP"),(!r.staticSubnet||!f.test(r.staticSubnet))&&(t.staticSubnet="Invalid subnet mask")}if(!r.clientIsRTU){const f=/^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/;(!r.sip||!f.test(r.sip))&&(t.sip="Invalid server IP address")}return g(t),Object.keys(t).length===0},b=async t=>{if(t.preventDefault(),!!h()){c(!0),a(null);try{await P.updateConfig(r),u(!0),setTimeout(()=>u(!1),3e3)}catch(f){a(f.message||"Failed to update configuration")}finally{c(!1)}}},n=(t,f)=>{l(x=>({...x,[t]:f})),p[t]&&g(x=>({...x,[t]:null}))},o=t=>p[t]?e("div",{style:"color: var(--danger-color); font-size: 0.875rem; margin-top: 0.25rem;",children:p[t]}):null;return e("div",{children:[e("h1",{style:"margin-bottom: 2rem;",children:"Configuration"}),s&&e("div",{class:"card",style:"background-color: var(--danger-color); color: white; margin-bottom: 1rem;",children:e("p",{style:"margin: 0;",children:[e(S,{size:16,style:"display: inline; margin-right: 0.25rem;"}),s]})}),d&&e("div",{class:"card",style:"background-color: var(--success-color); color: white; margin-bottom: 1rem;",children:e("p",{style:"margin: 0;",children:"✅ Configuration updated successfully!"})}),e("form",{onSubmit:b,children:[e("div",{class:"card",children:[e("h3",{class:"card-title",children:"General Settings"}),e("div",{class:"form-group",children:[e("label",{class:"form-label",for:"hostname",children:"Hostname"}),e("input",{type:"text",id:"hostname",class:"form-control",value:r.hostname,onInput:t=>n("hostname",t.target.value),placeholder:"esp32-proxy"}),o("hostname")]}),e("div",{class:"form-group",children:[e("label",{class:"form-label",for:"pi",children:"Polling Interval (ms)"}),e("input",{type:"number",id:"pi",class:"form-control",min:"100",value:r.pi,onInput:t=>n("pi",parseInt(t.target.value))}),o("pi")]}),e("div",{class:"form-group",children:e("div",{class:"form-check",children:[e("input",{type:"checkbox",id:"clientIsRTU",class:"form-check-input",checked:r.clientIsRTU,onChange:t=>n("clientIsRTU",t.target.checked)}),e("label",{class:"form-label",for:"clientIsRTU",children:"Modbus Client is RTU"})]})})]}),r.clientIsRTU&&e("div",{class:"card",children:[e("h3",{class:"card-title",children:"Modbus RTU Client"}),e("div",{style:"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;",children:[e("div",{class:"form-group",children:[e("label",{class:"form-label",for:"mb",children:"Baud Rate"}),e("input",{type:"number",id:"mb",class:"form-control",value:r.mb,onInput:t=>n("mb",parseInt(t.target.value))})]}),e("div",{class:"form-group",children:[e("label",{class:"form-label",for:"md",children:"Data Bits"}),e("input",{type:"number",id:"md",class:"form-control",min:"5",max:"8",value:r.md,onInput:t=>n("md",parseInt(t.target.value))})]})]}),e("div",{style:"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;",children:[e("div",{class:"form-group",children:[e("label",{class:"form-label",for:"mp",children:"Parity"}),e("select",{id:"mp",class:"form-control",value:r.mp,onChange:t=>n("mp",parseInt(t.target.value)),children:[e("option",{value:0,children:"None"}),e("option",{value:2,children:"Even"}),e("option",{value:3,children:"Odd"})]})]}),e("div",{class:"form-group",children:[e("label",{class:"form-label",for:"ms",children:"Stop Bits"}),e("select",{id:"ms",class:"form-control",value:r.ms,onChange:t=>n("ms",parseInt(t.target.value)),children:[e("option",{value:1,children:"1 bit"}),e("option",{value:2,children:"1.5 bits"}),e("option",{value:3,children:"2 bits"})]})]})]}),e("div",{class:"form-group",children:[e("label",{class:"form-label",for:"mr",children:"RTS Pin"}),e("select",{id:"mr",class:"form-control",value:r.mr,onChange:t=>n("mr",parseInt(t.target.value)),children:[e("option",{value:-1,children:"Auto"}),e("option",{value:4,children:"D4"}),e("option",{value:13,children:"D13"}),e("option",{value:14,children:"D14"}),e("option",{value:18,children:"D18"}),e("option",{value:19,children:"D19"}),e("option",{value:21,children:"D21"}),e("option",{value:22,children:"D22"}),e("option",{value:23,children:"D23"}),e("option",{value:25,children:"D25"}),e("option",{value:26,children:"D26"}),e("option",{value:27,children:"D27"}),e("option",{value:32,children:"D32"}),e("option",{value:33,children:"D33"})]})]})]}),!r.clientIsRTU&&e("div",{class:"card",children:[e("h3",{class:"card-title",children:"Modbus TCP Client Settings"}),e("div",{style:"display: grid; grid-template-columns: 2fr 1fr; gap: 1rem;",children:[e("div",{class:"form-group",children:[e("label",{class:"form-label",for:"sip",children:"Server IP Address"}),e("input",{type:"text",id:"sip",class:"form-control",value:r.sip,onInput:t=>n("sip",t.target.value),placeholder:"192.168.1.100"}),o("sip")]}),e("div",{class:"form-group",children:[e("label",{class:"form-label",for:"tp2",children:"Server Port"}),e("input",{type:"number",id:"tp2",class:"form-control",min:"1",max:"65535",value:r.tp2,onInput:t=>n("tp2",parseInt(t.target.value))})]})]})]}),e("div",{class:"card",children:[e("h3",{class:"card-title",children:"Modbus Secondary RTU (Server/Slave)"}),e("div",{style:"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;",children:[e("div",{class:"form-group",children:[e("label",{class:"form-label",for:"mb2",children:"Baud Rate"}),e("input",{type:"number",id:"mb2",class:"form-control",value:r.mb2,onInput:t=>n("mb2",parseInt(t.target.value))})]}),e("div",{class:"form-group",children:[e("label",{class:"form-label",for:"md2",children:"Data Bits"}),e("input",{type:"number",id:"md2",class:"form-control",min:"5",max:"8",value:r.md2,onInput:t=>n("md2",parseInt(t.target.value))})]})]}),e("div",{style:"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;",children:[e("div",{class:"form-group",children:[e("label",{class:"form-label",for:"mp2",children:"Parity"}),e("select",{id:"mp2",class:"form-control",value:r.mp2,onChange:t=>n("mp2",parseInt(t.target.value)),children:[e("option",{value:0,children:"None"}),e("option",{value:2,children:"Even"}),e("option",{value:3,children:"Odd"})]})]}),e("div",{class:"form-group",children:[e("label",{class:"form-label",for:"ms2",children:"Stop Bits"}),e("select",{id:"ms2",class:"form-control",value:r.ms2,onChange:t=>n("ms2",parseInt(t.target.value)),children:[e("option",{value:1,children:"1 bit"}),e("option",{value:2,children:"1.5 bits"}),e("option",{value:3,children:"2 bits"})]})]})]}),e("div",{class:"form-group",children:[e("label",{class:"form-label",for:"mr2",children:"RTS Pin"}),e("select",{id:"mr2",class:"form-control",value:r.mr2,onChange:t=>n("mr2",parseInt(t.target.value)),children:[e("option",{value:-1,children:"Auto"}),e("option",{value:4,children:"D4"}),e("option",{value:13,children:"D13"}),e("option",{value:14,children:"D14"}),e("option",{value:18,children:"D18"}),e("option",{value:19,children:"D19"}),e("option",{value:21,children:"D21"}),e("option",{value:22,children:"D22"}),e("option",{value:23,children:"D23"}),e("option",{value:25,children:"D25"}),e("option",{value:26,children:"D26"}),e("option",{value:27,children:"D27"}),e("option",{value:32,children:"D32"}),e("option",{value:33,children:"D33"})]})]})]}),e("div",{class:"card",children:[e("h3",{class:"card-title",children:"Modbus Secondary TCP Server"}),e("div",{class:"form-group",children:[e("label",{class:"form-label",for:"tp3",children:"Port Number"}),e("input",{type:"number",id:"tp3",class:"form-control",min:"1",max:"65535",value:r.tp3,onInput:t=>n("tp3",parseInt(t.target.value))})]})]}),e("div",{class:"card",children:[e("h3",{class:"card-title",children:"Serial (Debug)"}),e("div",{style:"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;",children:[e("div",{class:"form-group",children:[e("label",{class:"form-label",for:"sb",children:"Baud Rate"}),e("input",{type:"number",id:"sb",class:"form-control",value:r.sb,onInput:t=>n("sb",parseInt(t.target.value))})]}),e("div",{class:"form-group",children:[e("label",{class:"form-label",for:"sd",children:"Data Bits"}),e("input",{type:"number",id:"sd",class:"form-control",min:"5",max:"8",value:r.sd,onInput:t=>n("sd",parseInt(t.target.value))})]})]}),e("div",{style:"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;",children:[e("div",{class:"form-group",children:[e("label",{class:"form-label",for:"sp",children:"Parity"}),e("select",{id:"sp",class:"form-control",value:r.sp,onChange:t=>n("sp",parseInt(t.target.value)),children:[e("option",{value:0,children:"None"}),e("option",{value:2,children:"Even"}),e("option",{value:3,children:"Odd"})]})]}),e("div",{class:"form-group",children:[e("label",{class:"form-label",for:"ss",children:"Stop Bits"}),e("select",{id:"ss",class:"form-control",value:r.ss,onChange:t=>n("ss",parseInt(t.target.value)),children:[e("option",{value:1,children:"1 bit"}),e("option",{value:2,children:"1.5 bits"}),e("option",{value:3,children:"2 bits"})]})]})]})]}),e("div",{class:"card",children:[e("h3",{class:"card-title",children:"Network Settings"}),e("div",{class:"form-group",children:e("div",{class:"form-check",children:[e("input",{type:"checkbox",id:"useStaticIP",class:"form-check-input",checked:r.useStaticIP,onChange:t=>n("useStaticIP",t.target.checked)}),e("label",{class:"form-label",for:"useStaticIP",children:"Use Static IP"})]})}),r.useStaticIP&&e("div",{children:[e("div",{class:"form-group",children:[e("label",{class:"form-label",for:"staticIP",children:"Static IP Address"}),e("input",{type:"text",id:"staticIP",class:"form-control",value:r.staticIP,onInput:t=>n("staticIP",t.target.value),placeholder:"192.168.1.100"}),o("staticIP")]}),e("div",{style:"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;",children:[e("div",{class:"form-group",children:[e("label",{class:"form-label",for:"staticGateway",children:"Gateway IP"}),e("input",{type:"text",id:"staticGateway",class:"form-control",value:r.staticGateway,onInput:t=>n("staticGateway",t.target.value),placeholder:"192.168.1.1"}),o("staticGateway")]}),e("div",{class:"form-group",children:[e("label",{class:"form-label",for:"staticSubnet",children:"Subnet Mask"}),e("input",{type:"text",id:"staticSubnet",class:"form-control",value:r.staticSubnet,onInput:t=>n("staticSubnet",t.target.value),placeholder:"255.255.255.0"}),o("staticSubnet")]})]})]})]}),e("div",{style:"display: flex; gap: 1rem; margin-top: 2rem;",children:e("button",{type:"submit",class:"btn btn-primary",disabled:i,style:"flex: 1;",children:i?e(k,{children:"⏳ Saving..."}):e(k,{children:[e(be,{size:16,style:"margin-right: 0.25rem;"}),"Save Configuration"]})})})]})]})}const Me={1:"Read Coils",2:"Read Discrete Inputs",3:"Read Holding Registers",4:"Read Input Registers"};function Pe(){const[r,l]=m({slave:1,reg:1,func:3,count:1}),[i,c]=m(null),[s,a]=m(!1),[d,u]=m(null),[p,g]=m([]),h=(o,t)=>{l(f=>({...f,[o]:parseInt(t)}))},b=async o=>{o.preventDefault(),a(!0),u(null),c(null);const t=Date.now();try{const f=await P.sendDebugCommand(r.slave,r.reg,r.func,r.count),I=Date.now()-t,w={timestamp:new Date().toLocaleTimeString(),command:`Slave ${r.slave}, Function ${r.func}, Register ${r.reg}, Count ${r.count}`,duration:`${I}ms`,response:f,success:!f.includes("Error:")};c(w),g(C=>[w,...C.slice(0,9)])}catch(f){const x={timestamp:new Date().toLocaleTimeString(),command:`Slave ${r.slave}, Function ${r.func}, Register ${r.reg}, Count ${r.count}`,duration:`${Date.now()-t}ms`,response:f.message,success:!1,error:!0};c(x),u(f.message||"Debug command failed")}finally{a(!1)}},n=()=>{g([]),c(null),u(null)};return e("div",{children:[e("h1",{style:"margin-bottom: 2rem;",children:"Modbus Debug Tools"}),d&&e("div",{class:"card",style:"background-color: var(--danger-color); color: white; margin-bottom: 1rem;",children:e("p",{style:"margin: 0;",children:[e(S,{size:16,style:"display: inline; margin-right: 0.25rem;"}),d]})}),e("div",{class:"card",children:[e("h3",{class:"card-title",children:"Send Modbus Command"}),e("form",{onSubmit:b,children:[e("div",{style:"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;",children:[e("div",{class:"form-group",children:[e("label",{class:"form-label",for:"slave",children:"Slave ID"}),e("input",{type:"number",id:"slave",class:"form-control",min:"0",max:"247",value:r.slave,onInput:o=>h("slave",o.target.value)})]}),e("div",{class:"form-group",children:[e("label",{class:"form-label",for:"func",children:"Function Code"}),e("select",{id:"func",class:"form-control",value:r.func,onChange:o=>h("func",o.target.value),children:Object.entries(Me).map(([o,t])=>e("option",{value:o,children:[o," - ",t]},o))})]})]}),e("div",{style:"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;",children:[e("div",{class:"form-group",children:[e("label",{class:"form-label",for:"reg",children:"Register Address"}),e("input",{type:"number",id:"reg",class:"form-control",min:"0",max:"65535",value:r.reg,onInput:o=>h("reg",o.target.value)})]}),e("div",{class:"form-group",children:[e("label",{class:"form-label",for:"count",children:"Count"}),e("input",{type:"number",id:"count",class:"form-control",min:"1",max:"125",value:r.count,onInput:o=>h("count",o.target.value)})]})]}),e("div",{style:"display: flex; gap: 1rem;",children:[e("button",{type:"submit",class:"btn btn-primary",disabled:s,style:"flex: 1;",children:s?e(k,{children:"⏳ Sending..."}):e(k,{children:[e(U,{size:16,style:"margin-right: 0.25rem;"}),"Send Command"]})}),e("button",{type:"button",class:"btn btn-danger",onClick:n,children:[e(_,{size:16,style:"margin-right: 0.25rem;"}),"Clear History"]})]})]})]}),i&&e("div",{class:"card",children:[e("h3",{class:"card-title",children:i.success?e(k,{children:[e(O,{size:18,style:"display: inline; margin-right: 0.25rem;"}),"Command Result"]}):e(k,{children:[e(S,{size:18,style:"display: inline; margin-right: 0.25rem;"}),"Command Failed"]})}),e("div",{style:"background-color: var(--light-color); padding: 1rem; border-radius: 4px; margin-bottom: 1rem;",children:e("div",{style:"display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; font-size: 0.875rem;",children:[e("div",{children:[e("strong",{children:"Command:"})," ",i.command]}),e("div",{children:[e("strong",{children:"Time:"})," ",i.timestamp]}),e("div",{children:[e("strong",{children:"Duration:"})," ",i.duration]}),e("div",{children:[e("strong",{children:"Status:"}),e("span",{style:`color: ${i.success?"var(--success-color)":"var(--danger-color)"};`,children:i.success?"Success":"Failed"})]})]})}),e("div",{style:"background-color: #1e1e1e; color: #ffffff; padding: 1rem; border-radius: 4px; font-family: monospace; font-size: 0.875rem; white-space: pre-wrap; overflow-x: auto;",children:i.response})]}),p.length>0&&e("div",{class:"card",children:[e("h3",{class:"card-title",children:"Command History"}),e("div",{style:"max-height: 400px; overflow-y: auto;",children:p.map((o,t)=>e("div",{style:"border-bottom: 1px solid var(--border-color); padding: 1rem 0; margin-bottom: 1rem;",children:[e("div",{style:"display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;",children:[e("div",{style:"font-size: 0.875rem; color: var(--text-muted);",children:[o.timestamp," • ",o.duration]}),e("div",{style:`font-size: 0.875rem; font-weight: bold; color: ${o.success?"var(--success-color)":"var(--danger-color)"};`,children:o.success?e(k,{children:[e(O,{size:14,style:"display: inline; margin-right: 0.25rem;"}),"Success"]}):e(k,{children:[e(S,{size:14,style:"display: inline; margin-right: 0.25rem;"}),"Failed"]})})]}),e("div",{style:"font-size: 0.875rem; margin-bottom: 0.5rem;",children:[e("strong",{children:"Command:"})," ",o.command]}),e("div",{style:"background-color: #f8f9fa; padding: 0.75rem; border-radius: 4px; font-family: monospace; font-size: 0.8125rem; max-height: 150px; overflow-y: auto;",children:o.response})]},t))})]}),e("div",{class:"card",children:[e("h3",{class:"card-title",children:"📚 Modbus Quick Reference"}),e("div",{style:"display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;",children:[e("div",{children:[e("h4",{children:"Function Codes:"}),e("ul",{style:"font-size: 0.875rem; line-height: 1.6;",children:[e("li",{children:[e("strong",{children:"01:"})," Read Coils (0x references)"]}),e("li",{children:[e("strong",{children:"02:"})," Read Discrete Inputs (1x references)"]}),e("li",{children:[e("strong",{children:"03:"})," Read Holding Registers (4x references)"]}),e("li",{children:[e("strong",{children:"04:"})," Read Input Registers (3x references)"]})]})]}),e("div",{children:[e("h4",{children:"ET112 Common Registers:"}),e("ul",{style:"font-size: 0.875rem; line-height: 1.6;",children:[e("li",{children:[e("strong",{children:"0:"})," Voltage L1-N"]}),e("li",{children:[e("strong",{children:"6:"})," Current L1"]}),e("li",{children:[e("strong",{children:"12:"})," Power L1"]}),e("li",{children:[e("strong",{children:"46:"})," Frequency"]}),e("li",{children:[e("strong",{children:"72:"})," Total Active Energy Import"]})]})]})]}),e("div",{style:"margin-top: 1rem; padding: 1rem; background-color: var(--light-color); border-radius: 4px; font-size: 0.875rem;",children:[e("h4",{style:"margin-top: 0;",children:"💡 Tips:"}),e("ul",{style:"margin: 0; padding-left: 1.5rem;",children:[e("li",{children:"Use Function 3 (Read Holding Registers) for most ET112 data"}),e("li",{children:"Start with Slave ID 1 and Register 0, Count 1 for basic testing"}),e("li",{children:"Check the logs for detailed Modbus communication traces"}),e("li",{children:"Values are returned as raw hex - interpretation depends on register type"})]})]})]})]})}function De(){const[r,l]=m(""),[i,c]=m(!0),[s,a]=m(null),[d,u]=m(!0),[p,g]=m(0),[h,b]=m(!1),[n,o]=m(!1),t=j(),f=j(),x=async(v=!1)=>{try{const M=(await P.getLogs(v?0:p)).split(`
`);if(M.length>=3){const N=parseInt(M[0]),A=M[1]==="1",H=M.slice(2).join(`
`);g(N),b(A),v?l(H):H.trim()&&l(te=>te+H)}a(null)}catch(z){console.error("Failed to fetch logs:",z),a(z.message||"Failed to fetch logs")}finally{c(!1)}},I=async()=>{try{await P.clearLogs(),l(""),g(0),a(null)}catch(v){a(v.message||"Failed to clear logs")}},w=()=>{o(v=>!v)};L(()=>{if(d&&t.current&&!n){const v=t.current;v.scrollTop=v.scrollHeight}},[r,d,n]),L(()=>(x(!0),f.current=setInterval(()=>{n||x(!1)},2e3),()=>{f.current&&clearInterval(f.current)}),[n,p]);const C=v=>{const z=v.target,M=Math.abs(z.scrollHeight-z.scrollTop-z.clientHeight)<10;u(M)};return i?e("div",{class:"loading",children:"Loading logs..."}):e("div",{children:[e("div",{style:"display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;",children:[e("h1",{style:"margin: 0;",children:"System Logs"}),e("div",{style:"display: flex; gap: 0.5rem; align-items: center;",children:[e("button",{class:`btn ${n?"btn-success":"btn-primary"}`,onClick:w,style:"padding: 0.5rem 1rem; font-size: 0.875rem;",children:n?e(k,{children:[e(fe,{size:16,style:"margin-right: 0.25rem;"}),"Resume"]}):e(k,{children:[e(K,{size:16,style:"margin-right: 0.25rem;"}),"Pause"]})}),e("button",{class:"btn btn-danger",onClick:I,style:"padding: 0.5rem 1rem; font-size: 0.875rem;",children:[e(_,{size:16,style:"margin-right: 0.25rem;"}),"Clear"]}),e("button",{class:"btn btn-primary",onClick:()=>x(!0),style:"padding: 0.5rem 1rem; font-size: 0.875rem;",children:[e(ye,{size:16,style:"margin-right: 0.25rem;"}),"Refresh"]})]})]}),e("div",{style:"display: flex; gap: 1rem; margin-bottom: 1rem; font-size: 0.875rem;",children:[e("div",{style:`color: ${n?"var(--warning-color)":"var(--success-color)"};`,children:n?e(k,{children:[e(K,{size:16,style:"display: inline; margin-right: 0.25rem;"}),"Paused"]}):e(k,{children:[e(F,{size:16,style:"display: inline; margin-right: 0.25rem;"}),"Live"]})}),h&&e("div",{style:"color: var(--warning-color);",children:[e(q,{size:16,style:"display: inline; margin-right: 0.25rem;"}),"Buffer overflow - some logs may be missing"]}),e("div",{style:"color: var(--text-muted);",children:["Position: ",p]}),e("div",{style:`color: ${d?"var(--success-color)":"var(--text-muted)"};`,children:d?e(k,{children:[e(E,{size:16,style:"display: inline; margin-right: 0.25rem;"}),"Auto-scroll ON"]}):e(k,{children:[e(E,{size:16,style:"display: inline; margin-right: 0.25rem;"}),"Auto-scroll OFF"]})})]}),s&&e("div",{class:"card",style:"background-color: var(--danger-color); color: white; margin-bottom: 1rem;",children:e("p",{style:"margin: 0;",children:[e(S,{size:16,style:"display: inline; margin-right: 0.25rem;"}),s]})}),e("div",{class:"card",style:"padding: 0; overflow: hidden;",children:e("div",{ref:t,onScroll:C,style:{height:"600px",overflow:"auto",padding:"1rem",backgroundColor:"#1e1e1e",color:"#ffffff",fontFamily:'Monaco, "Cascadia Code", "Roboto Mono", Consolas, "Courier New", monospace',fontSize:"0.875rem",lineHeight:"1.4",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:r||"No logs available. Waiting for log data..."})}),e("div",{style:"margin-top: 1rem; padding: 1rem; background-color: var(--light-color); border-radius: 4px; font-size: 0.875rem; color: var(--text-muted);",children:[e("h4",{style:"margin-top: 0;",children:[e(pe,{size:18,style:"display: inline; margin-right: 0.25rem;"}),"Tips:"]}),e("ul",{style:"margin: 0; padding-left: 1.5rem;",children:[e("li",{children:[e("strong",{children:"Auto-scroll:"})," Scroll to bottom to enable auto-scroll for new logs"]}),e("li",{children:[e("strong",{children:"Pause:"})," Use pause to stop fetching new logs while investigating"]}),e("li",{children:[e("strong",{children:"Clear:"})," Clear logs to reduce memory usage and start fresh"]}),e("li",{children:[e("strong",{children:"Live updates:"})," Logs refresh automatically every 2 seconds when not paused"]})]})]})]})}function Re(){const[r,l]=m(null),[i,c]=m(!1),[s,a]=m(0),[d,u]=m(null),[p,g]=m(!1),[h,b]=m(null),n=j(),o=w=>{const C=w.target.files[0];C&&(l(C),u(null),g(!1),b(null))},t=w=>{if(!w)return"Please select a file to upload";const C=[".bin",".hex",".elf"],v=w.name.toLowerCase();if(!C.some(A=>v.endsWith(A)))return`Invalid file type. Please select a firmware file (${C.join(", ")})`;const M=10*1024*1024;return w.size>M?"File too large. Maximum size is 10MB":w.size<1024?"File too small. Are you sure this is a valid firmware file?":null},f=async()=>{const w=t(r);if(w){u(w);return}c(!0),u(null),a(0);try{const C=await P.uploadFirmware(r,v=>{a(v)});g(!0),b({message:"Firmware uploaded successfully! The device will restart automatically.",details:C}),l(null),n.current&&(n.current.value="")}catch(C){u(C.message||"Upload failed"),a(0)}finally{c(!1)}},x=()=>{l(null),u(null),g(!1),a(0),b(null),n.current&&(n.current.value="")},I=w=>{if(w===0)return"0 Bytes";const C=1024,v=["Bytes","KB","MB","GB"],z=Math.floor(Math.log(w)/Math.log(C));return parseFloat((w/Math.pow(C,z)).toFixed(2))+" "+v[z]};return e("div",{children:[e("h1",{style:"margin-bottom: 2rem;",children:"Firmware Update"}),e("div",{class:"card",style:"background-color: #fff3cd; border: 1px solid #ffeaa7; color: #856404; margin-bottom: 2rem;",children:[e("h3",{style:"margin-top: 0; color: #856404;",children:[e(q,{size:20,style:"display: inline; margin-right: 0.5rem;"}),"Important Warning"]}),e("ul",{style:"margin: 0; padding-left: 1.5rem; line-height: 1.6;",children:[e("li",{children:[e("strong",{children:"Do not disconnect power"})," during the update process"]}),e("li",{children:[e("strong",{children:"Do not close this page"})," until the update completes"]}),e("li",{children:["The device will ",e("strong",{children:"restart automatically"})," after successful update"]}),e("li",{children:["Only upload ",e("strong",{children:"valid ESP32 firmware files"})," (.bin, .hex, .elf)"]}),e("li",{children:["Uploading incorrect firmware may ",e("strong",{children:"brick your device"})]})]})]}),d&&e("div",{class:"card",style:"background-color: var(--danger-color); color: white; margin-bottom: 1rem;",children:e("p",{style:"margin: 0;",children:[e(S,{size:16,style:"display: inline; margin-right: 0.25rem;"}),d]})}),p&&h&&e("div",{class:"card",style:"background-color: var(--success-color); color: white; margin-bottom: 1rem;",children:[e("h3",{style:"margin-top: 0;",children:[e(O,{size:20,style:"display: inline; margin-right: 0.5rem;"}),"Update Successful!"]}),e("p",{style:"margin: 0;",children:h.message}),h.details&&e("div",{style:"margin-top: 1rem; padding: 1rem; background-color: rgba(255,255,255,0.1); border-radius: 4px; font-family: monospace; font-size: 0.875rem; white-space: pre-wrap;",children:h.details})]}),e("div",{class:"card",children:[e("h3",{class:"card-title",children:"Select Firmware File"}),e("div",{class:"form-group",children:[e("label",{class:"form-label",children:"Choose Firmware File"}),e("input",{ref:n,type:"file",class:"form-control",accept:".bin,.hex,.elf",onChange:o,disabled:i}),e("div",{style:"font-size: 0.875rem; color: var(--text-muted); margin-top: 0.5rem;",children:"Supported formats: .bin, .hex, .elf • Maximum size: 10MB"})]}),r&&e("div",{style:"background-color: var(--light-color); padding: 1rem; border-radius: 4px; margin-top: 1rem;",children:[e("h4",{style:"margin-top: 0;",children:"Selected File:"}),e("div",{style:"display: grid; grid-template-columns: auto 1fr auto; gap: 1rem; align-items: center;",children:[e("div",{children:e(E,{size:24})}),e("div",{children:[e("div",{style:"font-weight: 500;",children:r.name}),e("div",{style:"font-size: 0.875rem; color: var(--text-muted);",children:[I(r.size)," • ",r.type||"Binary file"]})]}),e("button",{class:"btn btn-danger",onClick:x,disabled:i,style:"padding: 0.5rem; font-size: 0.875rem;",children:e(Ce,{size:16})})]})]})]}),i&&e("div",{class:"card",children:[e("h3",{class:"card-title",children:[e(F,{size:18,style:"display: inline; margin-right: 0.25rem;"}),"Uploading Firmware"]}),e("div",{style:"margin-bottom: 1rem;",children:[e("div",{style:"display: flex; justify-content: space-between; margin-bottom: 0.5rem;",children:[e("span",{children:"Upload Progress"}),e("span",{children:[s,"%"]})]}),e("div",{style:"width: 100%; background-color: #e0e0e0; border-radius: 4px; height: 20px; overflow: hidden;",children:e("div",{style:{width:`${s}%`,height:"100%",backgroundColor:"var(--primary-color)",transition:"width 0.3s ease-in-out"}})})]}),e("div",{style:"font-size: 0.875rem; color: var(--text-muted); text-align: center;",children:s===0?"Preparing upload...":s<100?"Uploading firmware...":"Processing firmware..."})]}),e("div",{style:"display: flex; gap: 1rem; margin-top: 2rem;",children:[e("button",{class:"btn btn-primary",onClick:f,disabled:!r||i,style:"flex: 1;",children:i?e(k,{children:"⏳ Uploading..."}):e(k,{children:[e(W,{size:16,style:"margin-right: 0.25rem;"}),"Start Upload"]})}),e("button",{class:"btn btn-danger",onClick:x,disabled:i,children:[e(_,{size:16,style:"margin-right: 0.25rem;"}),"Clear"]})]}),e("div",{class:"card",style:"margin-top: 2rem;",children:[e("h3",{class:"card-title",children:[e(ue,{size:18,style:"display: inline; margin-right: 0.25rem;"}),"Update Process"]}),e("div",{style:"display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;",children:[e("div",{children:[e("h4",{children:"Before Updating:"}),e("ol",{style:"font-size: 0.875rem; line-height: 1.6;",children:[e("li",{children:"Ensure stable power supply"}),e("li",{children:"Verify firmware file integrity"}),e("li",{children:"Note current firmware version"}),e("li",{children:"Close unnecessary browser tabs"})]})]}),e("div",{children:[e("h4",{children:"After Update:"}),e("ol",{style:"font-size: 0.875rem; line-height: 1.6;",children:[e("li",{children:"Device will restart automatically"}),e("li",{children:"Wait ~30 seconds for boot"}),e("li",{children:"Reconnect to device IP/hostname"}),e("li",{children:"Verify new firmware version"})]})]})]}),e("div",{style:"margin-top: 1.5rem; padding: 1rem; background-color: var(--light-color); border-radius: 4px; font-size: 0.875rem;",children:[e("h4",{style:"margin-top: 0;",children:[e(U,{size:18,style:"display: inline; margin-right: 0.25rem;"}),"Build Instructions"]}),e("p",{style:"margin: 0;",children:"To build firmware for this device:"}),e("div",{style:"background-color: #1e1e1e; color: #ffffff; padding: 0.75rem; border-radius: 4px; margin-top: 0.5rem; font-family: monospace;",children:["# Debug build",e("br",{}),"pio run -e esp32debug",e("br",{}),e("br",{}),"# Release build",e("br",{}),"pio run -e esp32release",e("br",{}),e("br",{}),"# Output: .pio/build/esp32debug/firmware.bin"]})]})]})]})}function Fe(){const[r,l]=m("/");return e("div",{class:"app",children:[e(xe,{currentRoute:r}),e("main",{class:"main-content",children:e(le,{onChange:c=>{l(c.url);const s={"/":"Home","/status":"Status","/config":"Configuration","/debug":"Debug","/log":"Logs","/update":"Firmware Update"};document.title=`ESP32 ET112 Proxy - ${s[c.url]||"Unknown"}`},children:[e(R,{path:"/",component:ze}),e(R,{path:"/status",component:Se}),e(R,{path:"/config",component:Ie}),e(R,{path:"/debug",component:Pe}),e(R,{path:"/log",component:De}),e(R,{path:"/update",component:Re})]})})]})}ne(e(Fe,{}),document.getElementById("app"));
